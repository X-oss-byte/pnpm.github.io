"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7340],{9613:(e,n,a)=>{a.d(n,{Zo:()=>s,kt:()=>f});var r=a(9496);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,r,t=function(e,n){if(null==e)return{};var a,r,t={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var i=r.createContext({}),c=function(e){var n=r.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):p(p({},n),e)),a},s=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var a=e.components,t=e.mdxType,o=e.originalType,i=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=t,f=u["".concat(i,".").concat(m)]||u[m]||d[m]||o;return a?r.createElement(f,p(p({ref:n},s),{},{components:a})):r.createElement(f,p({ref:n},s))}));function f(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=a.length,p=new Array(o);p[0]=m;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l[u]="string"==typeof e?e:t,p[1]=l;for(var c=2;c<o;c++)p[c]=a[c];return r.createElement.apply(null,p)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1304:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>f,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var r=a(1966),t=a(9836),o=(a(9496),a(9613)),p=["components"],l={id:"fetch",title:"pnpm fetch"},i=void 0,c={unversionedId:"cli/fetch",id:"version-7.x/cli/fetch",title:"pnpm fetch",description:"Descargar paquetes indicados en un lockfile a la tienda virtual, el manifiesto de paquetes es ignorado.",source:"@site/i18n/es/docusaurus-plugin-content-docs/version-7.x/cli/fetch.md",sourceDirName:"cli",slug:"/cli/fetch",permalink:"/es/7.x/cli/fetch",draft:!1,editUrl:"https://translate.pnpm.io/project/pnpm/es-ES",tags:[],version:"7.x",frontMatter:{id:"fetch",title:"pnpm fetch"},sidebar:"version-7.x/docs",previous:{title:"pnpm prune",permalink:"/es/7.x/cli/prune"},next:{title:"pnpm install-test",permalink:"/es/7.x/cli/install-test"}},s={},u=[{value:"Escenario de uso",id:"escenario-de-uso",level:2},{value:"Opciones",id:"opciones",level:2},{value:"--dev",id:"--dev",level:3},{value:"--prod",id:"--prod",level:3}],d={toc:u},m="wrapper";function f(e){var n=e.components,a=(0,t.Z)(e,p);return(0,o.kt)(m,(0,r.Z)({},d,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Descargar paquetes indicados en un lockfile a la tienda virtual, el manifiesto de paquetes es ignorado."),(0,o.kt)("h2",{id:"escenario-de-uso"},"Escenario de uso"),(0,o.kt)("p",null,"Este comando est\xe1 espec\xedficamente dise\xf1ado para mejorar la construcci\xf3n de una imagen Docker."),(0,o.kt)("p",null,"Puede haber le\xeddo la ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/en/docs/guides/nodejs-docker-webapp/"},"gu\xeda oficial")," para escribir un archivo Dockerfile para una aplicaci\xf3n de Node.js, si a\xfan no la ha le\xeddo, puede que quiera leerla primero."),(0,o.kt)("p",null,"De esa gu\xeda, aprendemos a escribir un Dockerfile optimizado para proyectos que usan pnpm, puede parecerse a algo tal que"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Dockerfile"},'FROM node:14\n\nRUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm\n\n# Files required by pnpm install\nCOPY .npmrc package.json pnpm-lock.yaml .pnpmfile.cjs ./\n\n# If you patched any package, include patches before install too\nCOPY patches patches\n\nRUN pnpm install --frozen-lockfile --prod\n\n# Bundle app source\nCOPY . .\n\nEXPOSE 8080\nCMD [ "node", "server.js" ]\n')),(0,o.kt)("p",null,"Siempre que no haya cambios en ",(0,o.kt)("inlineCode",{parentName:"p"},".npmrc"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"pnpm-lock.yaml"),", ",(0,o.kt)("inlineCode",{parentName:"p"},".pnpmfile.cjs"),", la cach\xe9 de compilaci\xf3n de Docker sigue siendo v\xe1lida hasta la capa de ",(0,o.kt)("inlineCode",{parentName:"p"},"RUN pnpm install --frozen-lockfile --prod"),", que cuesta la mayor parte del tiempo al crear una imagen Docker."),(0,o.kt)("p",null,"Sin embargo, la modificaci\xf3n de ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json")," puede ocurrir con mucha m\xe1s frecuencia de lo que esperamos, porque no solo contiene dependencias, sino que tambi\xe9n puede contener el n\xfamero de versi\xf3n, los scripts y la configuraci\xf3n arbitraria de cualquier otra herramienta."),(0,o.kt)("p",null,"Tambi\xe9n es dif\xedcil mantener un Dockerfile que crea un proyecto monorepo, puede parecerse a algo tal que"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Dockerfile"},'FROM node:14\n\nRUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm\n\n# Files required by pnpm install\nCOPY .npmrc package.json pnpm-lock.yaml .pnpmfile.cjs ./\n\n# If you patched any package, include patches before install too\nCOPY patches patches\n\n# for each sub-package, we have to add one extra step to copy its manifest\n# to the right place, as docker have no way to filter out only package.json with\n# single instruction\nCOPY packages/foo/package.json packages/foo/\nCOPY packages/bar/package.json packages/bar/\n\nRUN pnpm install --frozen-lockfile --prod\n\n# Bundle app source\nCOPY . .\n\nEXPOSE 8080\nCMD [ "node", "server.js" ]\n\n')),(0,o.kt)("p",null,"Como puede ver, el archivo Dockerfile tiene que ser actualizado cuando agregue o elimine sub-paquetes."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"pnpm fetch")," resuelve perfectamente el problema anterior al brindar la capacidad de cargar paquetes en la tienda virtual usando solo informaci\xf3n de un lockfile."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Dockerfile"},'FROM node:14\n\nRUN curl -f https://get.pnpm.io/v6.16.js | node - add --global pnpm\n\n# pnpm fetch does require only lockfile\nCOPY pnpm-lock.yaml ./\n\n# If you patched any package, include patches before running pnpm fetch \nCOPY patches patches\n\nRUN pnpm fetch --prod\n\n\nADD . ./\nRUN pnpm install -r --offline --prod\n\n\nEXPOSE 8080\nCMD [ "node", "server.js" ]\n')),(0,o.kt)("p",null,"Funciona tanto para proyectos simples como monorepo, ",(0,o.kt)("inlineCode",{parentName:"p"},"--offline")," obliga a pnpm a no comunicarse con el registro de paquetes, ya que todos los paquetes necesarios ya est\xe1n presentes en la tienda virtual."),(0,o.kt)("p",null,"Siempre que no se cambie el lockfile, la cach\xe9 de compilaci\xf3n es v\xe1lida hasta la capa, por lo que ",(0,o.kt)("inlineCode",{parentName:"p"},"RUN pnpm install -r --offline --prod"),", le ahorrar\xe1 mucho tiempo."),(0,o.kt)("h2",{id:"opciones"},"Opciones"),(0,o.kt)("h3",{id:"--dev"},"--dev"),(0,o.kt)("p",null,"S\xf3lo se descargar\xe1n los paquetes de desarrollo"),(0,o.kt)("h3",{id:"--prod"},"--prod"),(0,o.kt)("p",null,"Los paquetes de desarrollo no se descargar\xe1n"))}f.isMDXComponent=!0}}]);